<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="nuget.post.props" />

  <!--_ResolveNugetDependencies-->
  <Target
    Name="_ResolveNugetDependencies"
    BeforeTargets="RefreshTemplateExpansions">

    <ItemGroup>
      <_NugetPackageAttributeMap Include="NugetPackageAttribute">
        <Version>NuspecVersion</Version>
        <Name>NuspecId</Name>
      </_NugetPackageAttributeMap>
    </ItemGroup>

    <!--extract custom attributes-->
    <!--<AddAssemblyAttribute
      Assemblies="@(ReferencePath)"
      Attributes="@(_NugetPackageAttributeMap)"
    >
      <Output ItemName="_ReferencedNugetPackage" TaskParameter="Result" />
    </AddAssemblyAttribute>-->
    <GetAssemblyAttribute
      Assemblies="@(ReferencePath)"
      Attribute="@(_NugetPackageAttributeMap)"
    >
      <Output ItemName="_ReferencedNugetPackage" TaskParameter="Result" />
    </GetAssemblyAttribute>

    <!--augment NugetDependency-->
    <ItemGroup>
      <NugetDependency Include="@(_ReferencedNugetPackage->'%(NuspecId)')">
        <Version>%(_ReferencedNugetPackage.NuspecVersion)</Version>
      </NugetDependency>
    </ItemGroup>
    
    <Message 
      Text="  ReferencedNugetPackage: %(_ReferencedNugetPackage.Identity) -> %(NuspecId).%(NuspecVersion)"
      Condition="@(_ReferencedNugetPackage)!=''"
    />
  </Target>

</Project>